import OpenAI from 'openai';

// ‡∏î‡∏∂‡∏á Groq API Key ‡∏à‡∏≤‡∏Å Environment Variables
const apiKey = import.meta.env.VITE_GROQ_API_KEY;

console.log('üîë Groq API Key loaded:', apiKey ? `${apiKey.substring(0, 20)}...` : 'NOT FOUND');

if (!apiKey) {
  throw new Error('Missing Groq API Key. Please add VITE_GROQ_API_KEY to .env.local');
}

// ‡∏™‡∏£‡πâ‡∏≤‡∏á Groq Client (‡πÉ‡∏ä‡πâ OpenAI SDK ‡πÅ‡∏ï‡πà‡∏ä‡∏µ‡πâ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Groq endpoint)
const groq = new OpenAI({
  apiKey: apiKey,
  baseURL: 'https://api.groq.com/openai/v1',
  dangerouslyAllowBrowser: true, // ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô browser
});

/**
 * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Groq AI
 * ‡πÉ‡∏ä‡πâ Llama 3.3 70B Versatile (model ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á Groq)
 * @param mood - ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
 * @param luckScore - Luck Score ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡πà‡∏°‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß (0-100)
 */
export async function generateVibeWithAI(mood: string, luckScore: number) {
  try {
    const prompt = `
‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏´‡∏°‡∏≠‡∏î‡∏π‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡∏∏‡∏Å‡∏™‡∏ô‡∏≤‡∏ô ‡πÅ‡∏ã‡∏ß ‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à

‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å/‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏°‡∏≤‡∏ß‡πà‡∏≤: "${mood}"
‡∏î‡∏ß‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏ä‡∏Ñ‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠: ${luckScore}%

‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÅ‡∏•‡∏∞‡∏î‡∏ß‡∏á‡∏ô‡∏µ‡πâ ‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö JSON ‡∏ï‡∏≤‡∏°‡∏ô‡∏µ‡πâ:

{
  "fortune_text": "<‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô 1-2 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Å‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á ‡∏î‡∏ß‡∏á ${luckScore}% ‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå '${mood}'>",
  "colors": ["<hex color 1>", "<hex color 2>", "<hex color 3>"],
  "song": "<‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏•‡∏á‡πÑ‡∏ó‡∏¢‡∏¢‡∏∏‡∏Ñ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô>"
}

**‡∏Å‡∏é‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç - ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô:**

1. **‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á Luck Score (${luckScore}%) ‡∏Å‡∏±‡∏ö Mood (${mood}):**
   - **‡∏î‡∏ß‡∏á 80-100%:** ‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏ß‡∏Å‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à
     - ‡∏ñ‡πâ‡∏≤ mood ‡∏î‡∏µ: "‡∏î‡∏ß‡∏á‡∏î‡∏µ + ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏î‡∏µ = ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏à‡πã‡∏á‡∏™‡∏∏‡∏î!"
     - ‡∏ñ‡πâ‡∏≤ mood ‡πÅ‡∏¢‡πà: "‡πÅ‡∏°‡πâ‡∏à‡∏∞‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å[mood] ‡πÅ‡∏ï‡πà‡∏î‡∏ß‡∏á‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏™‡∏¥‡πà‡∏á‡∏î‡∏µ‡πÜ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô"

   - **‡∏î‡∏ß‡∏á 50-79%:** ‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏î‡∏∏‡∏•
     - ‡∏ñ‡πâ‡∏≤ mood ‡∏î‡∏µ: "‡∏î‡∏ß‡∏á‡∏î‡∏µ‡∏≠‡∏¢‡∏π‡πà ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏î‡∏µ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ"
     - ‡∏ñ‡πâ‡∏≤ mood ‡πÅ‡∏¢‡πà: "‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å[mood] ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°? ‡∏î‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á ‡πÅ‡∏ï‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏Å‡∏±‡∏á‡∏ß‡∏• ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏à‡∏∞‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô"

   - **‡∏î‡∏ß‡∏á 20-49%:** ‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
     - ‡∏ñ‡πâ‡∏≤ mood ‡∏î‡∏µ: "‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏î‡∏µ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡πÄ‡∏•‡∏¢! ‡πÅ‡∏°‡πâ‡∏î‡∏ß‡∏á‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å ‡πÅ‡∏ï‡πà‡πÉ‡∏à‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Å‡∏ß‡πà‡∏≤"
     - ‡∏ñ‡πâ‡∏≤ mood ‡πÅ‡∏¢‡πà: "‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å[mood] ‡∏î‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏à ‡πÅ‡∏ï‡πà‡∏ô‡∏µ‡πà‡πÅ‡∏´‡∏•‡∏∞‡∏Ñ‡∏∑‡∏≠‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÉ‡∏´‡πâ‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏î‡∏π‡πÅ‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á"

   - **‡∏î‡∏ß‡∏á 0-19%:** ‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡πÅ‡∏ã‡∏ß‡πÄ‡∏ö‡∏≤‡πÜ ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à
     - ‡∏ñ‡πâ‡∏≤ mood ‡∏î‡∏µ: "‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡πÅ‡∏ï‡πà‡∏î‡∏ß‡∏á‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏≠‡∏∞‡πÑ‡∏£‡∏°‡∏≤‡∏Å ‡∏û‡∏±‡∏Å‡πÄ‡∏ö‡∏≤‡πÜ ‡πÑ‡∏ß‡πâ‡πÄ‡∏Å‡πá‡∏ö‡πÅ‡∏£‡∏á‡πÑ‡∏ß‡πâ‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ"
     - ‡∏ñ‡πâ‡∏≤ mood ‡πÅ‡∏¢‡πà: "‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å[mood] ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°? ‡∏î‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡πá‡πÑ‡∏°‡πà‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡πÉ‡∏à‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà ‡∏á‡∏±‡πâ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏û‡∏±‡∏Å‡πÄ‡∏¢‡∏≠‡∏∞‡πÜ ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡πá‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏à‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô"

2. **‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ 3 ‡∏™‡∏µ (hex code) ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå:**
   - ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏î‡∏µ/‡∏™‡∏î‡πÉ‡∏™ ‚Üí ‡πÇ‡∏ó‡∏ô‡∏ä‡∏°‡∏û‡∏π ‡∏™‡πâ‡∏° ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á ‡∏ó‡∏≠‡∏á (#FF69B4, #FFA500, #FFD700)
   - ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏™‡∏á‡∏ö/‡∏ú‡πà‡∏≠‡∏ô‡∏Ñ‡∏•‡∏≤‡∏¢ ‚Üí ‡πÇ‡∏ó‡∏ô‡∏ü‡πâ‡∏≤ ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß ‡∏°‡πà‡∏ß‡∏á‡∏≠‡πà‡∏≠‡∏ô (#87CEEB, #90EE90, #DDA0DD)
   - ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÄ‡∏®‡∏£‡πâ‡∏≤/‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢ ‚Üí ‡πÇ‡∏ó‡∏ô‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏° ‡∏°‡πà‡∏ß‡∏á‡πÄ‡∏Ç‡πâ‡∏° ‡πÄ‡∏ó‡∏≤ (#4169E1, #6A5ACD, #708090)
   - ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÇ‡∏Å‡∏£‡∏ò/‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î ‚Üí ‡πÇ‡∏ó‡∏ô‡πÅ‡∏î‡∏á ‡∏™‡πâ‡∏°‡πÄ‡∏Ç‡πâ‡∏° (#DC143C, #FF4500, #8B0000)

3. **‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏•‡∏á‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏à‡∏£‡∏¥‡∏á:**
   - ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏•‡∏á‡πÑ‡∏ó‡∏¢‡∏¢‡∏∏‡∏Ñ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå
   - ‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏®‡∏¥‡∏•‡∏õ‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢
   - ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: "‡∏≠‡∏¢‡∏π‡πà - Tilly Birds", "‡πÄ‡∏´‡∏á‡∏≤ - ‡πÄ‡∏≠‡πä‡∏∞ ‡∏à‡∏¥‡∏£‡∏≤‡∏Å‡∏£", "‡∏Ñ‡∏¥‡∏î‡∏ñ‡∏∂‡∏á‡πÄ‡∏ò‡∏≠‡∏ó‡∏∏‡∏Å‡∏ó‡∏µ - Atom ‡∏ä‡∏ô‡∏Å‡∏±‡∏ô‡∏ï‡πå"

**‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å:**
- ‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡∏û‡∏π‡∏î‡∏ñ‡∏∂‡∏á‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏ó‡∏µ‡πà user ‡∏Å‡∏£‡∏≠‡∏Å‡∏°‡∏≤ (${mood}) ‡πÅ‡∏•‡∏∞‡∏î‡∏ß‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ (${luckScore}%)
- **‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡∏ô‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢** (‡∏´‡πâ‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤‡∏à‡∏µ‡∏ô ‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© ‡∏´‡∏£‡∏∑‡∏≠‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏õ‡∏ô)
- **‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö 1-2 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô** ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏≤‡∏ß
- **‡∏´‡πâ‡∏≤‡∏°‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ã‡πâ‡∏≥‡∏ã‡∏≤‡∏Å** ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏ô‡∏∏‡∏Å

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö):**
- Mood "‡πÄ‡∏®‡∏£‡πâ‡∏≤‡∏°‡∏≤‡∏Å" + ‡∏î‡∏ß‡∏á 85% ‚Üí "‡πÅ‡∏°‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÄ‡∏®‡∏£‡πâ‡∏≤ ‡πÅ‡∏ï‡πà‡∏î‡∏ß‡∏á‡∏î‡∏µ‡∏ñ‡∏∂‡∏á 85% ‡∏•‡∏∏‡πâ‡∏ô‡∏°‡∏µ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏µ‡πÜ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ‡πÅ‡∏ô‡πà!"
- Mood "‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç" + ‡∏î‡∏ß‡∏á 60% ‚Üí "‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡∏î‡∏µ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏à‡πã‡∏á! ‡∏î‡∏ß‡∏á 60% ‡∏Å‡πá‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏™‡∏ö‡∏≤‡∏¢‡πÜ"
- Mood "‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢‡∏°‡∏≤‡∏Å" + ‡∏î‡∏ß‡∏á 22% ‚Üí "‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°? ‡∏î‡∏ß‡∏á‡πÅ‡∏Ñ‡πà 22% ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏û‡∏±‡∏Å‡πÄ‡∏¢‡∏≠‡∏∞‡πÜ ‡∏ô‡∏∞"

‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô JSON ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏´‡πâ‡∏≤‡∏°‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏∑‡πà‡∏ô ‡∏´‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡∏ô‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
`;

    console.log('ü§ñ Calling Groq AI...');

    const completion = await groq.chat.completions.create({
      model: 'llama-3.3-70b-versatile', // Groq's best model
      messages: [
        {
          role: 'system',
          content: 'You are a helpful assistant that only responds in valid JSON format.',
        },
        {
          role: 'user',
          content: prompt,
        },
      ],
      temperature: 1.2,
      max_tokens: 1024,
      response_format: { type: 'json_object' }, // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô JSON
    });

    const responseText = completion.choices[0]?.message?.content || '{}';

    console.log('ü§ñ Groq AI Response (raw):', responseText);

    // Parse JSON
    const vibeData = JSON.parse(responseText);

    console.log('‚úÖ Parsed Vibe Data:', vibeData);

    // Validate ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    if (
      typeof vibeData.fortune_text !== 'string' ||
      !Array.isArray(vibeData.colors) ||
      vibeData.colors.length !== 3 ||
      typeof vibeData.song !== 'string'
    ) {
      throw new Error('Invalid response format from Groq AI');
    }

    // Return ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å AI (‡πÑ‡∏°‡πà‡∏°‡∏µ luck_score ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏£‡∏≤‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß)
    return vibeData;
  } catch (error) {
    console.error('Groq AI Error:', error);
    throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ AI ‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á');
  }
}
